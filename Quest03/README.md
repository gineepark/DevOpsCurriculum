# Quest 03. 네트워크의 기초

## Introduction

- 이번 퀘스트에서는 인터넷이 어떻게 동작하며, 서버와 클라이언트, 웹 브라우저 등의 역할은 무엇인지 알아보겠습니다.

## Topics

- 서버와 클라이언트, 그리고 웹 브라우저
- 인터넷을 구성하는 여러 가지 프로토콜
    - IP
    - TCP
    - HTTP
- DNS

## Resources

- [OSI 모형](https://ko.wikipedia.org/wiki/OSI_%EB%AA%A8%ED%98%95)
- [인터넷 프로토콜](https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
- [traceroute](https://ping.eu/traceroute/)
- [TCP](https://ko.wikipedia.org/wiki/%EC%A0%84%EC%86%A1_%EC%A0%9C%EC%96%B4_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
- [Wireshark](https://www.wireshark.org/download.html)
- [HTTP](https://ko.wikipedia.org/wiki/HTTP)
- [DNS](https://ko.wikipedia.org/wiki/%EB%8F%84%EB%A9%94%EC%9D%B8_%EB%84%A4%EC%9E%84_%EC%8B%9C%EC%8A%A4%ED%85%9C)
- [Web-Based Dig](https://networking.ringofsaturn.com/Tools/dig.php)

## Checklist

- 인터넷은 어떻게 동작하나요? OSI 7 Layer에 입각하여 설명해 보세요.
    - 인터넷의 가장 기본적인 것은, 컴퓨터들이 서로 통신 가능한 거대한 네트워크라는 것이다.
    - 컴퓨터들끼리 통신, 즉 대화하기 위해서는 나름의 규칙이 필요하다.
    - OSI 7 계층은 인터넷  세계에서 통신 방법을 정의해 놓은 규칙이다.
    
    ### OSI 참조 모델이란
    
    - 네트워크 통신 과정을 **7단계**로 나누어 **상호 연동 가능한 네트워크 구조**를 설계하는 모델이다!
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0ce4ce66-bfbd-4005-b1d3-7185b1e9b6b5/Untitled.png)
        
    - OSI 참조모델을 통해 기본적인 HW, SW를 변경하지 않고도 **시스템 간의 통신을 개방**할 수 있다.
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4ee5336b-2246-49db-8a8a-941b9b74fff4/Untitled.png)
        
    - 7계층은 상/하위 계층으로 나뉠 수 있다.
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/98b70a3f-5579-4692-9e56-f64a1456e20f/Untitled.png)
        
        - **상위 계층 :** 애플리케이션 개발자들이 고려할 영역으로, 하위 계층을 고려하지 않고 데이터를 표현하는데 초점을 맞춘다.
        - **하위 계층 :** 네트워크 엔지니어가 고려하는 영역으로, 다른 시스템으로 전송되는 데이터의 물리적인 면(전기적 규격, 물리 주소, 전송 시간 등)을 처리한다.
        
    - OSI 참조 모델 데이터 전송
        
        ### **데이터 단위**
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/51c0eef7-f36c-4663-9871-3f854d8569c4/Untitled.png)
        
        - 각 계층은 헤더와 데이터 단위로 정의된다.
            - 헤더 : 각 계층의 기능과 관련 정보 포함
            - 데이터 단위 : 헤더를 추가한 데이터를 전송하는 기본 단위
                - 서비스 데이터 단위(SDU) : 상/하위 계층 사이에 주고 받는 것
                - 프로토콜 데이터 단위(PDU) : 같은 계층 사이에 주고 받는 것
                - PCI : SDU에 대한 제어 정보
                
                → 상위 계층이 전송하려는 데이터 SDU와 제어 계층인 PCI가 합쳐진 것이 PDU
                
        
        ### **OSI 참조 모델에서의 데이터 전송**
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1eb6beb9-a81d-4c54-b7f9-1024fa5b5811/Untitled.png)
        
        다음과 같이 응용계층의 데이터에서 부터 점점 하위 계층으로 내려가면서 헤더가 추가된다(캡슐화)
        
        ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/eb282eac-5bf1-4fe2-a7b7-5829a2d31d66/Untitled.png)
        
        데이터 플로계층(1~4계층)에서는 네트워크 전송을 위한 헤더를 붙여 넣는다
        
        현대 네트워크는 대부분 패킷 기반 네트워크이기 때문에, 데이터를 패킷이라는 작은 단위로 쪼개 보내줘야 한다.
        
        ### **OSI 참조 모델에서의 데이터 수신**
        
        - 전송은 수신에서 데이터 흐름이 정반대로 간다.
        - 물리계층에서 수신 받은 전기신호를 데이터 형태로 올려준다.
        - 2계층에서는 랜카드가 자신에게 온 패킷이 맞는지 확인해 헤더 정보를 제거하고 3계층으로 올려준다.
        - 3,4계층도 마찬가지로 자신에게 온 것인지 확인헤서 헤더 정보를 제거하고 데이터를 애플리케이션에 올려보내준다.
        
        ### **정리**
        
        - 실제 데이터는 상위 계층 → 하위계층, 하위 계층 → 상위 계층 전달된다.
        - 헤더 정보는 각 계층끼리 전달된다.
    - OSI 참조 모델 각 계층
        
        ### L1 : 물리계층
        
        - 주로 전기 신호를 전달하는데 초점을 맞춘다
        - 데이터 단위 : 0과 1로 구성된 비트열의 데이터 → 전기신호로 바꿈
        - 주요 장비
            - 네트워크 통신 중재하는 장치 : 허브, 리피터
            - 컴퓨터의 랜카드와 케이블을 연결하는 장치 : 케이블, 커넥터, 트랜시버
            - 전기 신호를 다른 장비로 복제 : 탭
        - 들어온 전기 신호를 그대로 잘 전달하는 것을 목적으로 하기 때문에, 전기 신호가 1계층 장비에 들어오면 이 전기 신호를 재생성해서 내보낸다.
        - 1계층 장비는 주소의 개념이 없으므로, 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송한다.
            
            ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2b6fd4a2-4fd8-4ff3-8564-3cf165e1de69/Untitled.png)
            
            → 이를 해결하기 위해 데이터 링크 계층에서 동작하는 **`스위치`**가 등장!
            
        
        ### L2 : 데이터 링크 계층
        
        - 신뢰성 있는 데이터 전송
        - 데이터 단위 : **프레임** (트레일러 + 패킷 + 헤더)
            
            ![74742239-D8FB-4BA0-80EF-A404A26D32A2.jpeg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0fd0cb3b-a41c-49a5-a6fb-5a5a3870f223/74742239-D8FB-4BA0-80EF-A404A26D32A2.jpeg)
            
            - 이더넷 헤더 : 수신지 MAC + 송신지 MAC + 유형 (IPv4, ARP … )
            - 트레일러 : 데이터 전송시 오류가 있는지 확인하는데 사용
            
            > 이더넷이란 데이터 링크 계층에서 네트워크 접속 장치 간에 신호를 주고 받는 규칙 중 하나로, 허브와 같은 네트워크 접속 장치에 연결된 컴퓨터와 데이터를 전송받을 때 사용된다!
            > 
            
            > MAC 주소 : **랜카드에 할당된 전 세계에서 유일한 번호로 물리 주소**라고도 불린다. (48비트)
            > 
        - **허브**
            - **CSMA/CD :** 허브를 이용할 때 동시에 데이터를 전송하면 충돌할 수 있기 때문에 CS, MA, CD 신호로 충돌을 방지한다.
            - 작동 방식 정리
                1. 데이터 링크계층에서 만든 프레임을 물리 계층에서 전기신호로 변환한다.
                2. 허브에 연결된 모든 컴퓨터는 해당 전기 신호를 받고, 이를 데이터링크 계층에 프레임으로 변환하여 전달한다.
                3. 헤더를 통해 수신지 MAC주소가 맞는지 확인하고 아니면 폐기, 맞으면 헤더와 트레일러를 제거하고 네트워크 계층으로 전달한다.
                
                허브에서 전송하기 전 CSMA/CD 신호로 데이터가 충돌되지 않는지 확인한다.
                
        - **스위치**
            
            ![A3753230-5F50-4EA4-9083-F47DDBA4C353.jpeg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4c63b6dc-99d5-40f0-84ed-e6cae1ffe28f/A3753230-5F50-4EA4-9083-F47DDBA4C353.jpeg)
            
            - 데이터를 동시에 송수신할 수 있어 충돌이 발생하지 않음, 따라서 최근에는 스위치 사용
            - MAC 주소 테이블 (브리지 테이블)
                - MAC 주소 테이블은 **스위치의 포트 번호**, 해당 포트에 연결되어 있는 컴퓨터의 **MAC주소**
                - 필터링을 통해 수신지 컴퓨터에만 데이터가 전송됨 → 불필요한 데이터를 네트워크에 전송하지 않음
                - 플러딩 : MAC 주소가 등록되지 않으면 송신포트 제외 모든 포트에 데이터를 전송
            - 작동 방식 정리
                - 데이터 링크 계층에서 만든 프레임을 물리계층이 받아 전기 신호로 변환한다.
                - 스위치로 전송된 전기 신호는 MAC주소 테이블을 기반으로 스위치가 포트 포워딩 해준다.
                - 알맞은 목적지에 도착한 전기신호는 데이터링크 계층에서 헤더와 트레일러를 제거하고 네트워크 계층으로 전달된다.
        - **네트워크 인터페이스 카드(NIC)**
            - 고유한 MAC (Media Access Control) 주소가 있음
            - 데이터에서 도착지 MAC 주소를 확인 후 자신에게 들어오는 전기신호가 맞으면 상위 계층에서 처리 할 수 있도록 메모리 적재함
        
        ### L3 : 네트워크 계층
        
        - 데이터 링크 계층은 이더넷 규칙을 기반으로 하기 때문에 다른 네트워크로나 인터넷으로는 데이터를 전송할 수 없음
            
            → 서로 다른 네트워크 간의 통신을 가능하게 하려면 **라우터**라는 네트워크 접속 장치가 필요함
            
            → MAC주소가 아닌 어떤 네트워크의 어떤 컴퓨터인지 구분할 수 있게 해주는 인터넷 주소인 **IP주소** 필요
            
        - 데이터 단위 : **패킷** (세그먼트 + 헤더)
        - IP주소 체계
            - 32비트 (보통 8비트씩 나누어서 표시)
        - 라우터
            - IP 주소를 사용해 최적의 경로를 찾아주고, 해당 경로로 패킷을 포워딩해줌
            - 홉-바이-홉
                - 인접한 라우터까지만 경로를 지정하면 인접 라우터에서 최적의 경로를 다시 파악한 후 라우터로 패킷을 포워딩함.
                - 넥스트 홉 : 인접한 라우터
            - TTL
                - 3계층 IP 헤더, 패킷이 네트워크에 살아 있을 수 있는 시간(홉) 제한
                - 0이 되면 네트워크 장비에서 버려짐
                - 하나의 홉을 지날때마다 1씩 줄어듬
            - 라우팅 과정
                1. 수신지의IP 주소와 서브넷 마스크로 AND 연산 후 네트워크 주소 확인
                2. 수신지 네트워크 주소를 바탕으로 라우터의 라우팅 테이블을 검색
                    
                    수신지의 IP 주소 + 서브넷 마스크
                    
                    or 넥스트 홉
                    
                3. 수신 경로를 확인 후 IP 패킷의 TTL에서 1을 뺀다 → IP 헤더의 검사합을 다시 계산 → 데이터 링크 계층의 헤더를 교체한다.
                4. 이런 과정을 반복하며 다음 네트워크로 계속 중계함
        
        ### L4 : 전송 계층
        
        - 역할 : 신뢰성 있는 전송을 보장하기 위해 오류 검출 및 복구와 흐름 제어 수행
        - 데이터 전송 단위 : 세그먼트(Segment)
        - 프로토콜 : TCP, UDP
        - 장비 : 게이트웨이, L4스위치
        
        ### L5 : 세션 계층
        
        - 역할 : 응용 프로그램간에 사용할 데이터 교환을 위한 세션과 대화 방식을 결정데이터
        - 전송 단위 : 데이터(Data)
        - 프로토콜 : SSH, TLS
        
        ### L6 : 표현 계층
        
        - 역할 : 응용계층에서 전달된 데이터를 공통된 형식으로 변환, 압축, 암호화하는 기능 수행
        - 전송 단위 : 데이터(Data)
        - 프로토콜 : JPEG. MPEG
        
        ### L7 : 응용 계층
        
        응용 프로세스와 직접적으로 관계하여 일반적인 응용 서비스를 수행한다.최종 사용자와 직접 상호작용하여 다른 분산 정보 서비스 중에서도 이메일, 네트워크 데이터 공유, 파일 전송 및 디렉터리 서비스를 지원한다.
        
        네트워킹 엔티티를 식별하여 최종 사용자 요청에 의한 네트워킹 요청을 용이하게 하고, 리소스 가용성을 결정하고, 통신을 동기화하고, 애플리케이션별 네트워킹 요구사항을 관리한다.
        
        - 전송 단위 : 데이터(Data)
        - 프로토콜 : HTTP, FTP, SMTP, DNS, POP3, Telnet
        - 장치 : L7 스위치
    
- 우리가 브라우저의 주소 창에 `www.knowre.com` 을 쳤을 때, 어떤 과정을 통해 노리의 서버 주소를 알게 되나요?
    
    ![http://www.tcpschool.com/lectures/img_webbasic_10.png](http://www.tcpschool.com/lectures/img_webbasic_10.png)
    
    `[www.knowre.com](http://www.knowre.com)` 에 접속하기 위해서는 실제 해당 서버의 ip를 알아야 한다.
    
    따라서 DNS 서버에 `[www.knowre.com](http://www.knowre.com)`를 질의 하고, 그에 대한 응답으로 ip 주소를 받아온다.
    
    ![Screen Shot 2022-12-05 at 9.08.50 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e89a59a3-95c0-41fb-8d6a-d93c66651473/Screen_Shot_2022-12-05_at_9.08.50_PM.png)
    
    **이 과정을 조금 더 자세히 알아 보자**
    
    1. 사용자는 브라우저에 "`www.knowre.com`"을 입력한다.
    
    2. 로컬 host 파일을 검색한다. 이를 로컬 DNS 서버로 일컫는다.
    
    - 맥북 기준 host 파일 경로 : `/private/etc/hosts`
        
        ![Screen Shot 2022-12-05 at 9.41.43 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1d4d7240-59e2-440f-8a30-84847b0d5e24/Screen_Shot_2022-12-05_at_9.41.43_PM.png)
        
    
    3. 해당 파일에 IP 정보가 있을 경우, host 파일의 IP 정보를 전달한다.
    
    4. 파일에 없을 경우, Root DNS 서버에 질의를 전송한다.로컬 DNS 서버는 Root DNS 서버 정보를 가지고 있어야 한다.
    [Root DNS 서버는 전세계에 13대 구축되어 있다.](https://xn--3e0bx5euxnjje69i70af08bea817g.xn--3e0b707e/jsp/statboard/dns/dnsRoot/currentWorld.jsp) 우리나라의 경우 Root DNS 서버가 구축되어 있지는 않지만 Root DNS 서버에 대한 미러 서버를 3대 운용하고 있다.
    
    5. Root DNS 서버는 요청한 도메인 이름에 해당하는 IP 주소가 있으면 전달한다
    
    6. IP 주소가 존재하지 않는다면 다른 Root DNS 서버에게 질의하라고 응답한다. (이를 재귀적 질의라 한다)
    
    7. 재귀적 질의를 반복하여 IP 주소 정보를 확인하면 확인된 IP 주소 정보는 로컬 DNS 서버에서 캐싱처리 한다.
    
    > 도메인 계층 구조는 오른쪽부터 왼쪽으로 내려간다. 왼쪽의 레이블은 오른쪽의 서브도메인이다.  예를 들어, 레이블 **`knowre`**은 **`com`** 도메인의 서브도메인이며, **`www`**는 **`knowre.com`**
    의 서브도메인이다. 서브도메인은 127단계까지 가능하다.
    > 
    > 
    > DNS 이동 경로는 최상위 도메인(com)을 찾아가고 그 다음 서브 도메인 정보를 알고 있는 DNS 서버를 찾아간다. 그렇게 사용자가 요청한 전체 도메인 정보의 IP를 찾아가게 된다.
    > 
    
    **조금 더 쉽게 이해해 보자면**
    
    - 🤷‍♀️ : `www.knowre.com` 의 ip 정보가 궁금해!
        - 로컬 호스트 파일에서 도메인 정보 찾아봄
        - 만약에 없다면?
    - 🤵‍♂️ **루트 DNS 서버**에 요청한다.
        - 🤷‍♀️ “.com” 이라는 도메인 있나요?
        - 🤵‍♂️ : “.com” 네임 서버로 가보세요~
    - 👮‍♂️**최상위 기관(com)**에서 관리하는 dns 서버에 요청한다.
        - 🤷‍♀️ : “knowre.com” 도메인 있나요?
        - 👮‍♂️ : AWS로 가세요
    - **🧑‍🔧 AWS Route53**에게 요청한다.
        - 🤷‍♀️ : “www.knowre.com” 도메인 있나요?
        - **🧑‍🔧** : 네! [xxx.xxx.xxx.xxx](http://xxx.xxx.xxx.xxx) 로 가세요~
    
    **DNS는 계층적인 구조이다.**
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2f05d910-83e0-43fa-b465-408740b91c11/Untitled.png)
    
    - top domain : com
    - second-level domain : knowre
    - sub domain : www

## Quest

- **tracert(Windows가 아닌 경우 traceroute) 명령을 통해 `www.google.com` 까지 가는 경로를 찾아 보세요.**
    
    > traceroute 란
    > 
    > 
    > UDP 패킷을 생성하여 패킷이 목적지로 이동할 때 실제로 사용하는 경로를 검색한다.
    > 
    > ![https://ciksiti.com/f/c0b3c94f18cca55a5c8d2005e4c8a281.jpg](https://ciksiti.com/f/c0b3c94f18cca55a5c8d2005e4c8a281.jpg)
    > 
    > 이러한 방법으로 사용이 가능하다.
    > 
    > `traceroute [도메인명 혹은 IP주소]` 
    > 
    - **어떤 IP주소들이 있나요?**
        
        ```jsx
        $ traceroute www.google.com
        traceroute to www.google.com (216.58.220.132), 64 hops max, 52 byte packets
         1  172.27.8.1 (172.27.8.1)  4.684 ms  3.196 ms  3.187 ms
         2  172.27.0.1 (172.27.0.1)  3.397 ms  3.280 ms  4.686 ms
         3  58.233.160.65 (58.233.160.65)  6.239 ms  3.235 ms  4.155 ms
         4  100.80.46.141 (100.80.46.141)  3.383 ms  4.373 ms  3.404 ms
         5  10.45.253.160 (10.45.253.160)  4.248 ms  3.951 ms  4.364 ms
         6  10.222.35.86 (10.222.35.86)  14.634 ms
            10.222.24.184 (10.222.24.184)  3.846 ms
            10.222.25.66 (10.222.25.66)  4.738 ms
         7  10.222.23.49 (10.222.23.49)  11.861 ms
            10.222.25.245 (10.222.25.245)  19.780 ms
            10.222.8.183 (10.222.8.183)  5.717 ms
         8  * 72.14.196.26 (72.14.196.26)  42.247 ms
            142.250.162.140 (142.250.162.140)  63.372 ms
         9  * * *
        10  108.170.235.102 (108.170.235.102)  38.494 ms
            108.170.243.97 (108.170.243.97)  32.840 ms
            syd09s01-in-f132.1e100.net (216.58.220.132)  63.800 m
        ```
        
    - **그 IP주소들은 어디에 위치해 있나요?**
        
        router 
        
- **Wireshark를 통해 `www.google.com` 으로 요청을 날렸을 때 어떤 TCP 패킷이 오가는지 확인해 보세요**
    - TCP 패킷을 주고받는 과정은 어떻게 되나요?
        - 잘 모르겠음…
        
    - 각각의 패킷의 헤더에 어떤 정보들이 담겨 있나요?
        
        ![Screen Shot 2022-12-05 at 8.28.30 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/400d0e98-c88a-4102-abf0-ecab2ac53095/Screen_Shot_2022-12-05_at_8.28.30_PM.png)
        
- telnet 명령을 통해 `http://www.google.com/` URL에 HTTP 요청을 날려 보세요.
    - 어떤 헤더들이 있나요?
    - 그 헤더들은 어떤 역할을 하나요?
    

## Advanced

- HTTP의 최신 버전인 HTTP/3는 어떤 식으로 구성되어 있을까요?
- TCP/IP 외에 전세계적인 네트워크를 구성하기 위한 다른 방식도 제안된 바 있을까요?
